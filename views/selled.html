<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/all.css">
    <title>Selled Products</title>
</head>

<body>

    <nav id="navbar" class="navbar navbar-dark navbar-expand-md bg-dark text-light mb-2">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">New Bill</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-evenly" id="navbarNav">
                <ul class="navbar-nav d-flex w-100">
                    <li id="vsi" class="nav-item ms-1 mt-1">
                        <button class="btn btn-primary" id="btn-func" onclick="allBills()">All bills</button>
                    </li>

                    <li id="placali" class="nav-item ms-1 mt-1">
                        <button class="btn btn-success" id="btn-func" onclick="payedBills()">Payed</button>
                    </li>
                    <li id="nePlacali" class="nav-item ms-1 mt-1">
                        <button class="btn btn-danger" id="btn-func" onclick="notPayedBills()">Not Payed</button>
                    </li>
                    </li>
                    <li class="nav-item ms-1 mt-1">
                        <a href="/search"><button class="btn btn-info" id="btn-func"><strong>Search
                                    User</strong></button></a>
                    </li>

                    <li class="nav-item ms-auto">
                        <a class="nav-link" href="/logout"><button class="btn btn-outline-info ms-1"> Log
                                out</button></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="caption" id="caption">
        <%- include('../flashError') %>
            <h1><strong class="fs-1 text-primary">Vsi računi</strong></h1>
            <h2><strong class="fs-2 text-primary">Skupaj
                    <% for(data of yearNum){ %>
                        <%= data.numPerYear %>
                            <% } %>
                                izdanih računov
                </strong></h2>
    </div>

    <!--
     ALL BILLS
        -->

    <div id="allUsers" class="text-center mb-0">
        <table id="all" class="table table-dark table-hover mb-0">
            <thead id="table-data" class="text-center">
                <th class="col">User</th>
                <th class="col">Product</th>
                <th class="col-1">Qty</th>
                <th class="col-1">Price</th>
                <th class="col-1">DDV</th>
                <th class="col">1<sup>st</sup> / Week</th>
                <th class="col">Week</th>
                <th class="col">Total</th>
                <th class="col-1">Payed</th>
                <th class="col-1">Num / Month</th>
                <th class="col-1">Month</th>
                <th class="col-1">Num / Year</th>
                <th class="col">Year</th>
                <th class="col">Sold Date</th>
                <th class="col">Izdal</th>
            </thead>
            <tbody class="">
                <% if(userData.length) {%>

                    <% for(let data of userData) { %>
                        <% for(let product of data.products) {%>
                            <tr>

                                <% if(!data.payDate) {%>
                                    <td class="bg-danger">
                                        <a href="/all/<%= data._id %>">
                                            <strong class="text-info">
                                                <%= data.buyer %>
                                            </strong>
                                        </a>
                                    </td>
                                    <% } else{%>
                                        <td class="bg-success">
                                            <a href="/all/<%= data._id %>">
                                                <strong class="text-dark">
                                                    <%= data.buyer %>
                                                </strong>
                                            </a>
                                        </td>
                                        <% } %>
                                            <td>
                                                <%= product.name %>
                                            </td>

                                            <td>
                                                <%= product.qty %>
                                            </td>
                                            <td>
                                                <%= product.price %> &euro;
                                            </td>
                                            <td>
                                                1.50 €
                                            </td>
                                            <td>
                                                <% if(product.firstOfWeek=='true' ){ %>
                                                    <img src="../payed.jpg" alt="Free">
                                                    <% } else { %>
                                                        <img src="../notPay.jpg" alt="Not Free">
                                                        <% } %>
                                            </td>
                                            <td>
                                                <%= data.kt %>
                                            </td>
                                            <td>
                                                <%= product.total %> &euro;
                                            </td>
                                            <td>

                                                <% if(data.pay=='true' ){ %>
                                                    <img src="../payed.jpg" alt="Payed">
                                                    <% } else { %>
                                                        <img src="../notPay.jpg" alt="Not Payed">
                                                        <% } %>
                                            </td>
                                            <td>
                                                <%= data.numPerMonth %>
                                            </td>
                                            <td>
                                                <%= data.month %>
                                            </td>
                                            <td>
                                                <%= data.numPerYear %>
                                            </td>
                                            <td>
                                                <%= data.year %>
                                            </td>
                                            <td>
                                                <%= data.soldDate %>
                                            </td>
                                            <td>
                                                <%= data.izdal %>
                                            </td>
                            </tr>
                            <% } %>
                                <% } %>
                                    <% } else{%>
                                        <h1 class="mt-5">User and products database is empty. Nothing to show.</h1>
                                        <% } %>
            </tbody>
        </table>

    </div>

    <!-- PAYED BILLS -->

    <div class="caption" id="payedCaption">
        <h1 class=""><strong class="fs-1 text-success">Plačani Računi</strong></h1>
        <h2 class="d-inline"><strong class="fs-1 text-success" id="skupajPlacano"></strong></h2><br>
        <h3 class="d-inline"><strong class="fs-2 text-success">Skupaj plačano računov:
                <%= payedLength %>
            </strong>
        </h3>
    </div>

    <div id="placano" class="text-center">
        <table id="payed" class="table table-dark table-hover caption-top mb-0">

            <thead class="" id="table-head">
                <th>User</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Total &euro;</th>
                <th>1<sup>st</sup> / Week</th>
                <th>Payed</th>
                <th>Week</th>
                <th>Sold Date</th>
                <th>Pay Date</th>
                <th>Izdal</th>
            </thead>
            <tbody>
                <% if(payData.length) {%>


                    <% for(let user of payData) { %>
                        <% for(product of user.products) {%>
                            <tr class="fs-4">
                                <td><a href="/all/<%= userData._id%>">
                                        <%= user.buyer %>
                                    </a>
                                </td>

                                <td>
                                    <%= product.name %>
                                </td>
                                <td>
                                    <%= product.qty %>
                                </td>
                                <td>
                                    <%= product.total %> &euro;
                                </td>
                                <td>
                                    <% if(product.firstOfWeek=='true' ){ %>
                                        <img src="../payed.jpg" alt="">
                                        <% } else { %>
                                            <img src="../notPay.jpg" alt="">
                                            <% } %>
                                </td>
                                <td>
                                    <img src="../payed.jpg" alt="">
                                </td>
                                <td>
                                    <%= user.kt %>
                                </td>
                                <td>
                                    <%= user.soldDate %>
                                </td>
                                <td>
                                    <%= user.payDate %>
                                </td>
                                <td>
                                    <%= user.izdal %>
                                </td>
                            </tr>
                            <% } %>
                                <% } %>
                                    <% } %>


            </tbody>
        </table>
    </div>

    <!-- NOT PAYED BILLS -->
    <div class="caption" id="notPayedcaption">
        <h1><strong class="fs-1 text-danger">Dolžniki:</strong></h1>
        <h2 class="d-inline"><strong class="fs-2 text-danger" id="dolg"></strong></h2><br>
        <h3 class="d-inline"><strong class="fs-2 text-danger">Skupaj za plačat <%= notPayedLength %> računov!

            </strong>
        </h3>
    </div>
    <div id="niPlacano" class="text-center mb-0">
        <table id="notpayed" class="table table-dark table-hover mb-0">

            <thead class="">
                <th>User</th>
                <th>Product</th>
                <th>Bill ID</th>
                <th>Quantity</th>
                <th>Total &euro;</th>
                <th>Payed</th>
                <th>Week</th>
                <th>Sold Date</th>
                <th>Pay Date</th>
                <th>Izdal</th>
            </thead>
            <tbody class="text-danger">
                <% if(notPayData.length) {%>


                    <% for(let users of notPayData) { %>
                        <% for(product of users.products) {%>
                            <tr>
                                <td class="fs-4">
                                    <a href="/all/<%= users._id%>">
                                        <%= users.buyer %>
                                    </a>
                                </td>

                                <td>
                                    <%= product.name %>
                                </td>
                                <td>
                                    <%= users.id %>
                                </td>
                                <td class="fs-4">
                                    <%= product.qty %>
                                </td>

                                <td class="fs-4" value="<%= product.total %>">
                                    <%= product.total %> &euro;
                                </td>

                                <td>
                                    <img src="../notPay.jpg" alt="">
                                </td>
                                <td>
                                    <%= users.kt %>
                                </td>
                                <td>
                                    <%= users.soldDate %>
                                </td>
                                <td>
                                    <% if(users.payDate){ %>
                                        <%= users.payDate %>
                                            <% } else{%>
                                                Not payed
                                                <% } %>
                                </td>
                                <td>
                                    <%= users.izdal %>
                                </td>
                            </tr>
                            <% } %>
                                <% } %>
                                    <% } %>
                                        <tr class="fs-1">
                                            <td>Skupaj:</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td id="total"></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>

            </tbody>
        </table>
    </div>




    <script>
        let active = document.getElementById('vsi')
        active.classList.add('border-bottom', 'border-3', 'rounded-bottom', 'border-primary')
        document.getElementById('placano').style.display = 'none';
        document.getElementById('niPlacano').style.display = 'none';
        document.getElementById('payedCaption').style.display = 'none';
        document.getElementById('notPayedcaption').style.display = 'none';
        document.getElementById('allUsers').style.display = 'block';
        document.getElementById('allUsers').style.marginLeft = 'auto';
        document.getElementById('allUsers').style.marginRight = 'auto';

        function payedBills() {

            document.getElementById('allUsers').style.display = 'none';
            document.getElementById('niPlacano').style.display = 'none';
            document.getElementById('caption').style.display = 'none';
            document.getElementById('notPayedcaption').style.display = 'none';
            document.getElementById('payedCaption').style.display = 'block';
            document.getElementById('placano').style.display = 'block';
            document.getElementById('placano').style.marginLeft = 'auto';
            document.getElementById('placano').style.marginRight = 'auto';
            let active = document.getElementById('placali')
            active.classList.add('border-bottom', 'border-3', 'rounded-bottom', 'border-success')
            document.getElementById('vsi').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-primary')
            document.getElementById('nePlacali').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-danger')
            let placano = document.getElementById('payed');
            let rows = placano.rows.length - 1;
            let totalPayed = 0;
            for (let i = 1; i <= rows; i++) {
                var x = document.getElementById('payed').rows[i].cells[3].innerText;
                totalPayed += parseFloat(x, 10);
            }
            document.getElementById('skupajPlacano').innerHTML = "Skupaj: " + " " + totalPayed.toFixed(2) + " €";

        }
        function notPayedBills() {
            let active = document.getElementById('nePlacali')
            active.classList.add('border-bottom', 'border-3', 'rounded-bottom', 'border-danger')
            document.getElementById('placali').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-success')
            document.getElementById('vsi').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-primary')
            document.getElementById('placano').style.display = 'none';
            document.getElementById('allUsers').style.display = 'none';
            document.getElementById('caption').style.display = 'none';
            document.getElementById('payedCaption').style.display = 'none';
            document.getElementById('notPayedcaption').style.display = 'block';
            document.getElementById('niPlacano').style.display = 'block';
            document.getElementById('niPlacano').style.marginLeft = 'auto';
            document.getElementById('niPlacano').style.marginRight = 'auto';

            let all = document.getElementById('notpayed');
            let rows = all.rows.length - 2;

            let total = 0;
            for (let i = 1; i <= rows; i++) {
                var x = document.getElementById('notpayed').rows[i].cells[4].innerText;
                total += parseFloat(x, 10);
            }
            document.getElementById('total').innerHTML = "<strong>" + total.toFixed(2) + " " + "€" + "</strong>";
            document.getElementById('dolg').innerHTML = "Skupaj dolg:" + " " + total.toFixed(2) + " " + "€";


        }
        function allBills() {
            let active = document.getElementById('vsi')
            active.classList.add('border-bottom', 'border-3', 'rounded-bottom', 'border-primary')
            document.getElementById('placali').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-success')
            document.getElementById('nePlacali').classList.remove('border-bottom', 'border-3', 'rounded-bottom', 'border-danger')
            document.getElementById('placano').style.display = 'none';
            document.getElementById('niPlacano').style.display = 'none';
            document.getElementById('notPayedcaption').style.display = 'none';
            document.getElementById('payedCaption').style.display = 'none';
            document.getElementById('allUsers').style.display = 'block';
            document.getElementById('caption').style.display = 'block';
            document.getElementById('allUsers').style.marginLeft = 'auto';
            document.getElementById('allUsers').style.marginRight = 'auto';
        }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
</body>


</html>