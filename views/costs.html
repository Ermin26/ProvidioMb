<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Ermin Joldić">
    <meta name="keywords" content="izdaja-blaga, Izdaja-blaga, izdelava računov, primer izdelave računov">
    <meta name="description" content="izdaja-blaga, Ermin Joldić, interna izdaja blaga">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Costs</title>
</head>

<body>
    <nav id="navbar" class="navbar navbar-dark navbar-expand-md bg-dark text-light sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">New Bill</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav w-100">
                    <li class="nav-item ms-2">
                        <a class="nav-link" aria-current="page" href="/all"><button class="btn btn-primary">All
                                Bills</button></a>
                    </li>
                    <li class="nav-item ms-2 mt-2">
                        <a href="/search"><button class="btn btn-info" id="btn-func"><strong>Search
                                    User</strong></button></a>
                    </li>
                    <li class="nav-item ms-3 mt-2">
                        <a href="/costs"><button class="btn btn-danger"
                                id="btn-func"><strong>Costs</strong></button></a>
                    </li>
                    <% if(!currentUser) {%>
                        <li class="nav-item ms-auto">
                            <a class="nav-link" href="/login"><button class="btn btn-info">Log in</button></a>
                        </li>
                        <% }else { %>
                            <li class="nav-item ms-auto">
                                <a class="nav-link" href="/logout"><button
                                        class="btn btn-outline-info">Logout</button></a>
                            </li>
                            <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container text-center">
        <div class="addBills mt-5 mb-5">
            <button class="btn btn-primary" onclick="showInputForm()">Add new bill</button>
        </div>
        <div id="hideMe">
            <div id="addBillForm" class="col d-flex bg-info justify-content-center">
                <form action="/addCosts" method="post">
                    <div class="mb-2 text-center">
                        <label for="date" class="form-label">Bill Date:</label><br>
                        <input type="date" id="date" class="form-control text-center" name="date"
                            placeholder="Enter Bill date" required>
                    </div>

                    <div class="mb-2 col">
                        <label for="buyedProducts" class="form-label">Buyed products:</label>
                        <textarea type="text" id="buyedProducts" class="form-control text-center" name="buyedProducts"
                            placeholder="Enter buyed products" required></textarea>
                    </div>

                    <div class="mb-2">
                        <label for="totalPrice" class="form-label">Price:</label>
                        <input type="text" id="totalPrice" class="form-control text-center" name="totalPrice"
                            placeholder="Enter total price &euro;" required>
                    </div>

                    <button class="btn btn-success mt-4 mb-4">Submit</button>
                </form>
            </div>
        </div>

        <div class="header mt-3">
            <h1>Bills from using company money</h1>
        </div>

        <div id="bills">
            <% if(!allCosts.length) {%>
                <h1>Nothing to show yet. Add some bills</h1>
                <% }else {%>
                    <table id="tableOfCosts" class="table table-dark table-hover">
                        <tr>
                            <thead>
                                <th>Bill date</th>
                                <th>Total price &euro;</th>
                                <th>Buyed</th>
                                <th>Booked date</th>
                                <th>Booked by user</th>
                            </thead>
                        </tr>
                        <% for(data of allCosts) {%>
                            <tr>
                                <td>
                                    <%= data.date %>
                                </td>
                                <td>
                                    <%= data.totalPrice %> &euro;
                                </td>
                                <td>
                                    <%= data.buyedProducts %>

                                </td>
                                <td>
                                    <%= data.bookedDate %>
                                </td>
                                <td>
                                    <%= data.bookedUser %>
                                </td>
                            </tr>
                            <% } %>
                                <tr>
                                    <td>Total spend:</td>
                                    <td id="spend"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>

                    </table>
                    <% } %>
        </div>
    </div>


    <script>
        document.getElementById("hideMe").style.display = "none";
        function showInputForm() {
            document.getElementById("hideMe").style.display = "block";
        }
        let myTable = document.getElementById('tableOfCosts');
        let row = myTable.rows
        //console.log(row, "i am rows")
        let pay = 0;
        //console.log(row[2].cells[1].innerHTML, 'row + cells')
        for (let i = 1; i <= row.length; i++) {
            var x = document.getElementById('tableOfCosts').row[i].cells[1].innerHtml;
            console.log(x, ' i am x')
            pay += parseFloat(x, 10);
        }
        console.log(pay)
        document.getElementById('spend').innerHTML = pay.toFixed(2) + ' ' + '&euro;';

    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>

</body>

</html>